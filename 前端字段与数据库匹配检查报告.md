# 前端字段与数据库匹配检查报告

**检查日期**: 2025年10月14日  
**检查范围**: 数据库资料文件夹 + 前端Vue组件

---

## 📋 一、数据库资料检测结果

### 1.1 文件结构
```
参考/
├── admin-end.sql
├── teacher-student-end.sql
└── 数据库资料/
    ├── admin-end.sql  （✅ 与上级同名文件内容一致）
    └── teacher-student-end.sql  （✅ 与上级同名文件内容一致）
```

### 1.2 数据库表统计

**teacher-student-end.sql** 包含的主要表：
- ✅ `edu_student` - 学生信息表
- ✅ `edu_student_class` - 学生班级关联表
- ✅ `edu_student_course` - 学生选课表
- ✅ `edu_course` - 课程信息表
- ✅ `edu_class` - 班级信息表
- ✅ `edu_classroom` - 教室信息表
- ✅ `edu_teacher` - 教师信息表
- ✅ `edu_teaching_schedule` - 教学安排表
- ✅ `class_session` - 课堂会话表
- ❌ **缺失**: `edu_course_offering` - 课程开设表

**admin-end.sql** 包含：
- ✅ `sys_user` - 用户信息表
- ✅ `sys_role` - 角色信息表
- ✅ `sys_menu` - 菜单权限表
- ✅ `sys_dept` - 部门组织表
- 等其他系统管理表

---

## 🔍 二、前端字段匹配检查

### 2.1 Login.vue - 已修复 ✅

#### 登录表单字段
| 前端字段 | 数据库表 | 数据库字段 | 状态 |
|---------|---------|-----------|------|
| `user_name` | `sys_user` | `user_name` VARCHAR(30) | ✅ 匹配 |
| `password` | `sys_user` | `password` VARCHAR(100) | ✅ 匹配 |

#### 注册表单字段
| 前端字段 | 数据库表 | 数据库字段 | 状态 |
|---------|---------|-----------|------|
| `user_name` | `sys_user` | `user_name` VARCHAR(30) | ✅ 匹配 |
| `nick_name` | `sys_user` | `nick_name` VARCHAR(30) | ✅ 匹配 |
| `real_name` | `sys_user` | `real_name` VARCHAR(30) | ✅ 匹配 |
| `email` | `sys_user` | `email` VARCHAR(50) | ✅ 匹配 |
| `phone` | `sys_user` | `phone` VARCHAR(11) | ✅ 匹配 |
| `password` | `sys_user` | `password` VARCHAR(100) | ✅ 匹配 |

**修改说明**:
- ✅ 已将 `username` 改为 `user_name`
- ✅ 已将 `name` 拆分为 `nick_name` 和 `real_name`

---

### 2.2 CourseSchedule.vue - 字段不匹配 ⚠️

#### 课表数据字段（第599-611行）
```javascript
const courses = ref([
  {
    offering_id: 1001,      // ❌ 表 edu_course_offering 不存在
    course_id: 501,         // ✅ edu_course.course_id
    course_name: '计算机网络', // ✅ edu_course.course_name (冗余)
    teacher_id: 201,        // ✅ edu_teacher.teacher_id
    teacher_name: '孔老师',   // ✅ sys_user.real_name (冗余)
    week_day: 1,            // ❌ 无对应表字段
    start_period: 1,        // ❌ 无对应表字段
    end_period: 2,          // ❌ 无对应表字段
    classroom_id: 301,      // ✅ edu_classroom.classroom_id
    classroom_name: 'A301', // ✅ edu_classroom.classroom_name (冗余)
  }
]);
```

**问题分析**:

| 前端字段 | 期望的数据库表 | 实际情况 | 状态 |
|---------|--------------|---------|------|
| `offering_id` | `edu_course_offering` | ❌ 表不存在 | 🔴 严重 |
| `week_day` | `edu_course_offering` | ❌ 表不存在 | 🔴 严重 |
| `start_period` | `edu_course_offering` | ❌ 表不存在 | 🔴 严重 |
| `end_period` | `edu_course_offering` | ❌ 表不存在 | 🔴 严重 |

---

#### 选课列表字段（第765-777行）
```javascript
const courseList = ref([
  {
    enrollment_id: 2001,       // ✅ edu_student_course.enrollment_id
    course_id: 601,            // ✅ edu_course.course_id
    course_code: 'MATH101',    // ✅ edu_course.course_code
    course_name: '高等数学',    // ✅ edu_course.course_name (冗余)
    class_id: 101,             // ✅ edu_class.class_id
    class_name: '数学一班',     // ✅ edu_class.class_name (冗余)
    grade: 2025,               // ✅ edu_class.grade
    teacher_id: 211,           // ✅ edu_teacher.teacher_id
    teacher_name: '王老师',     // ✅ sys_user.real_name (冗余)
    credit: 4.0,               // ✅ edu_course.credit
    course_type: 'COMPULSORY', // ✅ edu_course.course_type
  }
]);
```

**字段匹配**:

| 前端字段 | 数据库表 | 数据库字段 | 状态 |
|---------|---------|-----------|------|
| `enrollment_id` | `edu_student_course` | `enrollment_id` INT | ✅ 匹配 |
| `course_id` | `edu_course` | `course_id` INT | ✅ 匹配 |
| `course_code` | `edu_course` | `course_code` VARCHAR(30) | ✅ 匹配 |
| `course_name` | `edu_course` | `course_name` VARCHAR(100) | ✅ 匹配 (冗余) |
| `class_id` | `edu_class` | `class_id` INT | ✅ 匹配 |
| `class_name` | `edu_class` | `class_name` VARCHAR(50) | ✅ 匹配 (冗余) |
| `grade` | `edu_class` | `grade` INT | ✅ 匹配 |
| `teacher_id` | `edu_teacher` | `teacher_id` INT | ✅ 匹配 |
| `teacher_name` | `sys_user` | `real_name` VARCHAR(30) | ✅ 匹配 (冗余) |
| `credit` | `edu_course` | `credit` DECIMAL(3,1) | ✅ 匹配 |
| `course_type` | `edu_course` | `course_type` ENUM | ✅ 匹配 |

**结论**: 选课列表字段完全匹配 ✅

---

## 🔴 三、核心问题：缺少 edu_course_offering 表

### 3.1 问题描述

数据库中**多处引用**了 `offering_id` 字段，但**没有定义** `edu_course_offering` 表：

#### 引用位置：
1. `edu_student_course.offering_id` - 学生选课表（第53行）
2. `edu_teaching_schedule.offering_id` - 教学安排表（第419行）
3. `edu_class_course.offering_id` - 班级课程关联表（第467行）
4. `prep_test_paper.offering_id` - 试卷表（第675行）

### 3.2 前端依赖的字段

前端 `CourseSchedule.vue` 需要以下字段：
- `offering_id` - 课程开设ID（主键）
- `course_id` - 课程ID
- `teacher_id` - 教师ID
- `classroom_id` - 教室ID
- `week_day` - 星期几（1-7）
- `start_period` - 开始节次（1-5）
- `end_period` - 结束节次（1-5）

### 3.3 建议的表结构（仅供后端参考）

```sql
CREATE TABLE `edu_course_offering` (
    `offering_id` INT NOT NULL AUTO_INCREMENT COMMENT '课程开设ID',
    `course_id` INT NOT NULL COMMENT '课程ID',
    `teacher_id` INT NOT NULL COMMENT '教师ID',
    `semester_id` INT NOT NULL COMMENT '学期ID',
    `classroom_id` INT COMMENT '教室ID',
    `week_day` TINYINT NOT NULL COMMENT '星期几（1-7）',
    `start_period` TINYINT NOT NULL COMMENT '开始节次（1-5）',
    `end_period` TINYINT NOT NULL COMMENT '结束节次（1-5）',
    `start_week` TINYINT DEFAULT 1 COMMENT '开始周',
    `end_week` TINYINT DEFAULT 20 COMMENT '结束周',
    `max_students` INT DEFAULT 50 COMMENT '最大学生数',
    `enrolled_students` INT DEFAULT 0 COMMENT '已选学生数',
    `status` ENUM('NORMAL','DISABLED','FULL') NOT NULL DEFAULT 'NORMAL',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `is_delete` TINYINT(1) DEFAULT 0,
    `delete_time` DATETIME,
    PRIMARY KEY (`offering_id`),
    KEY `idx_course_id` (`course_id`),
    KEY `idx_teacher_id` (`teacher_id`),
    KEY `idx_semester_id` (`semester_id`),
    KEY `idx_classroom_id` (`classroom_id`),
    KEY `idx_week_day` (`week_day`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='课程开设表';
```

---

## 📊 四、前端修改建议

### 4.1 如果后端无法添加 edu_course_offering 表

#### 方案1：使用现有表字段组合
```javascript
// 前端可以临时使用 edu_teaching_schedule 表的数据
// 但需要后端API配合，将排课信息整合返回
const courses = ref([
  {
    schedule_id: 1001,  // 使用 schedule_id 替代 offering_id
    course_id: 501,
    course_name: '计算机网络',
    // ... 其他字段
  }
]);
```

#### 方案2：前端注释说明，等待后端实现
```javascript
// TODO: 等待后端创建 edu_course_offering 表
// 当前数据结构为临时方案，后续需要调整
const courses = ref([
  // 模拟数据...
]);
```

### 4.2 前端API接口设计建议

```javascript
// 获取课表数据
// GET /api/student/schedule?semester_id=1&week=2
// 
// 后端返回格式（建议）:
{
  "code": 200,
  "data": [
    {
      "offering_id": 1001,
      "course_id": 501,
      "course_name": "计算机网络",  // 冗余字段
      "teacher_id": 201,
      "teacher_name": "孔老师",     // 冗余字段
      "classroom_id": 301,
      "classroom_name": "A301",    // 冗余字段
      "week_day": 1,
      "start_period": 1,
      "end_period": 2
    }
  ]
}
```

---

## ✅ 五、总结与建议

### 5.1 已完成的工作 ✅
1. ✅ **Login.vue** - 所有字段名已统一为数据库字段名
2. ✅ **ForgotPassword.vue** - 按钮样式已统一
3. ✅ **前端代码** - 无linter错误

### 5.2 待解决的问题 ⚠️

| 问题 | 优先级 | 负责方 | 状态 |
|-----|--------|--------|------|
| 缺少 `edu_course_offering` 表 | 🔴 最高 | 后端 | ❌ 未解决 |
| 课表功能无法使用 | 🔴 高 | 后端 | ❌ 未解决 |

### 5.3 前端状态
- ✅ 所有字段命名已与数据库一致
- ✅ 代码风格统一
- ✅ 无语法错误
- ⚠️ 等待后端表结构完善

### 5.4 后端需要做的工作

1. **必须**：创建 `edu_course_offering` 表
2. **必须**：提供课表查询API接口
3. **建议**：返回冗余字段减少前端查询次数

---

## 📝 六、字段命名规范总结

### 6.1 数据库命名规范
- ✅ 使用下划线命名法：`user_name`, `course_id`
- ✅ 主键统一格式：`表名_id`（如 `student_id`, `course_id`）
- ✅ 时间字段：`create_time`, `update_time`, `delete_time`
- ✅ 布尔字段：`is_xxx`（如 `is_delete`, `is_active`）

### 6.2 前端命名规范
- ✅ **与数据库保持一致**，使用下划线命名法
- ✅ 允许冗余字段（用于减少查询次数）
- ✅ 注释说明冗余字段来源

---

**检查完成时间**: 2025-10-14  
**检查工具**: AI代码分析 + SQL扫描  
**问题级别**: 🔴 严重（1个） | ⚠️ 需优化（0个） | ✅ 正常


