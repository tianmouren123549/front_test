<style scoped>
/* è¯¾ç¨‹/è¯¾è¡¨è§†å›¾å®¹å™¨ */
.course-schedule {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
}

/* è¯¾ç¨‹/è¯¾è¡¨è§†å›¾ */
.schedule-header {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  border-bottom: 1px solid #e5e7eb;
  flex-shrink: 0;
}

.controls {
  display: flex;
  align-items: center;
  gap: 10px;
}

.controls-right {
  justify-content: flex-end;
}

.view-tabs {
  display: inline-flex;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  overflow: hidden;
}

.view-tabs .el-button {
  border: 0;
  border-radius: 0;
}

.view-tabs .el-button + .el-button {
  margin-left: 0;
}

/* è¯¾è¡¨ç½‘æ ¼ */
.schedule-wrap {
  padding: 18px 22px;
}

.schedule-legend {
  display: flex;
  justify-content: flex-end;
  gap: 16px;
  margin-bottom: 10px;
  font-size: 12px;
  color: #6b7280;
  flex-shrink: 0;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 4px;
}

.schedule-grid {
  display: grid;
  grid-template-columns: 85px repeat(7, 1fr);
  grid-template-rows: auto repeat(5, minmax(120px, 1fr));
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  overflow: hidden;
  background: white;
  max-height: calc(100vh - 280px);
}

.grid-header {
  display: contents;
}

.grid-header div {
  padding: 16px 10px;
  font-weight: 600;
  text-align: center;
  color: #475569;
  font-size: 13px;
  background: linear-gradient(135deg, #f8fafc, #e2e8f0);
  border-bottom: 2px solid #e2e8f0;
  border-right: 1px solid #e5e7eb;
}

.time-col {
  grid-column: 1;
  grid-row: 2 / -1;
  display: flex;
  flex-direction: column;
  background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
  border-right: 1px solid #e5e7eb;
}

.time-slot {
  padding: 14px 10px;
  font-size: 12px;
  color: #6b7280;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  line-height: 1.4;
  flex: 1;
  border-bottom: 1px solid #e5e7eb;
  font-weight: 600;
}

.time-slot:last-child {
  border-bottom: none;
}

.schedule-cell {
  border-right: 1px solid #e5e7eb;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 12px 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.schedule-cell:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  z-index: 1;
}

.schedule-cell.empty {
  background: #fafafa;
  cursor: default;
}

.schedule-cell.empty:hover {
  transform: none;
  box-shadow: none;
}

/* è¯¾ç¨‹çŠ¶æ€ */
.course-done {
  background: linear-gradient(135deg, #ecfdf5, #dcfce7);
  border: 1px solid #a7f3d0;
}

.course-upcoming {
  background: linear-gradient(135deg, #fef7f7, #fee2e2);
  border: 1px solid #fca5a5;
}

.course-not-started {
  background: linear-gradient(135deg, #f9fafb, #f3f4f6);
  border: 1px solid #d1d5db;
}

.course-content {
  width: 100%;
  text-align: center;
}

.course-name {
  font-size: 14px;
  font-weight: 600;
  line-height: 1.3;
  margin-bottom: 4px;
  color: #374151;
}

.teacher-name {
  font-size: 12px;
  color: #6b7280;
  line-height: 1.2;
}

.status-icon {
  position: absolute;
  top: 6px;
  right: 6px;
  font-size: 10px;
}

/* è¯¾ç¨‹åˆ—è¡¨ */
.course-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
  padding: 20px;
}

.course-card {
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 18px;
  background: #fff;
  transition: all 0.2s;
  cursor: pointer;
}

.course-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
}

.course-placeholder {
  height: 120px;
  border: 1px dashed #e5e7eb;
  border-radius: 10px;
  background: #fafafa;
  margin-bottom: 12px;
}

.course-card h4 {
  margin: 0 0 8px 0;
  font-size: 16px;
  color: #1f2544;
}

.course-meta {
  color: #6b7280;
  font-size: 13px;
  margin-bottom: 4px;
}

/* å‘¨æ•°é€‰æ‹©å™¨ */
.week-picker {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.week-row {
  display: flex;
  align-items: center;
  gap: 12px;
}

.week-list {
  display: flex;
  align-items: center;
  gap: 12px;
}

.week-num {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  color: #334155;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
}

.week-num:hover {
  background: #f1f5f9;
}

.week-num.active {
  background: var(--primary-color);
  color: #fff;
  box-shadow: 0 4px 12px rgba(91, 124, 255, 0.35);
}

.week-info {
  color: #6b7280;
  font-size: 12px;
  text-align: center;
}

.week-current {
  color: var(--primary-color);
  font-weight: 600;
}

/* å…¨éƒ¨å‘¨æ•°å¼¹å‡ºå±‚æ ·å¼ */
.all-weeks-btn {
  margin-left: 8px;
  background: linear-gradient(135deg, #f8fafc, #e2e8f0) !important;
  border-color: #cbd5e1 !important;
  color: #475569 !important;
  font-weight: 500;
}

.all-weeks-btn:hover {
  background: linear-gradient(135deg, #e2e8f0, #cbd5e1) !important;
  border-color: #94a3b8 !important;
  color: #334155 !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.all-weeks-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 8px;
  padding: 12px;
  max-width: 280px;
}

.week-item {
  width: 44px;
  height: 44px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  color: #64748b;
  background: linear-gradient(135deg, #ffffff, #f8fafc);
  cursor: pointer;
  transition: all 0.25s ease;
}

.week-item:hover {
  border-color: #94a3b8;
  color: #334155;
  background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(100, 116, 139, 0.15);
}

.week-item.active {
  background: linear-gradient(135deg, var(--primary-color), #4f81f5);
  color: white;
  border-color: var(--primary-color);
  box-shadow: 0 4px 16px rgba(91, 124, 255, 0.35);
  font-weight: 600;
}

.week-item-label {
  font-size: 10px;
  color: #cbd5e1;
  margin-top: 2px;
  font-weight: 400;
}

.week-item:hover .week-item-label {
  color: #94a3b8;
}

.week-item.active .week-item-label {
  color: rgba(255, 255, 255, 0.85);
}

/* å“åº”å¼ */
@media (max-width: 1200px) {
  .course-list {
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  }
}

@media (max-width: 860px) {
  .schedule-header {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .controls {
    justify-content: center;
  }

  .schedule-grid {
    font-size: 11px;
  }

  .course-name {
    font-size: 11px;
  }

  .teacher-name {
    font-size: 9px;
  }
}
</style>

<script setup>
import { ref, computed } from 'vue';
import { ElMessage } from 'element-plus';

// å½“å‰è§†å›¾ï¼šschedule(è¯¾è¡¨) æˆ– courses(è¯¾ç¨‹åˆ—è¡¨)
const currentViewType = ref('schedule');

// å­¦æœŸåˆ—è¡¨
const semesters = ref([
  '2025-2026 ä¸Šå­¦æœŸ',
  '2025-2026 ä¸‹å­¦æœŸ',
  '2024-2025 ä¸Šå­¦æœŸ',
]);
const selectedSemester = ref('2025-2026 ä¸Šå­¦æœŸ');

// å½“å‰å‘¨æ•°
const currentWeek = ref(2);
const totalWeeks = 20;

// å‘¨æ•°åˆ—è¡¨ï¼ˆçª—å£æ˜¾ç¤º5ä¸ªï¼‰
const visibleWeeks = ref([]);

// å…¨éƒ¨å‘¨æ•°åˆ—è¡¨ï¼ˆç”¨äºå¼¹å‡ºå±‚æ˜¾ç¤ºï¼‰
const allWeeks = computed(() => {
  const weeks = [];
  for (let i = 1; i <= totalWeeks; i++) {
    weeks.push(i);
  }
  return weeks;
});

// æ›´æ–°å¯è§å‘¨æ•°
const updateVisibleWeeks = () => {
  const start = Math.max(1, Math.min(currentWeek.value - 2, totalWeeks - 4));
  visibleWeeks.value = [];
  for (let i = start; i <= Math.min(totalWeeks, start + 4); i++) {
    visibleWeeks.value.push(i);
  }
};

// åˆ‡æ¢å‘¨æ•°
const prevWeek = () => {
  if (currentWeek.value > 1) {
    currentWeek.value--;
    updateVisibleWeeks();
  }
};

const nextWeek = () => {
  if (currentWeek.value < totalWeeks) {
    currentWeek.value++;
    updateVisibleWeeks();
  }
};

const selectWeek = week => {
  currentWeek.value = week;
  updateVisibleWeeks();
};

// ä»å…¨éƒ¨å‘¨æ•°ä¸­é€‰æ‹©æŸå‘¨
const handleWeekSelect = week => {
  currentWeek.value = week;
  updateVisibleWeeks();
  ElMessage.success(`å·²åˆ‡æ¢åˆ°ç¬¬${week}å‘¨`);
};

// åˆå§‹åŒ–å‘¨æ•°
updateVisibleWeeks();

// ==================== ğŸ”´ æ¨¡æ‹Ÿæ•°æ® START ====================
// TODO: åç»­éœ€è¦ä»åç«¯APIè·å–è¯¾è¡¨æ•°æ®
// APIæ¥å£: GET /api/student/schedule?semesterId=xxx&week=xxx
// å¯¹åº”æ•°æ®åº“è¡¨ï¼šedu_course_offering, edu_course, sys_user, edu_teacher, edu_classroom

// è¯¾ç¨‹æ•°æ®
const courses = ref([
  {
    offering_id: 1001, // edu_course_offering.offering_id
    course_id: 501, // edu_course.course_id
    course_name: 'è®¡ç®—æœºç½‘ç»œ', // edu_course.course_name
    teacher_id: 201, // edu_teacher.teacher_id
    teacher_name: 'å­”è€å¸ˆ', // sys_user.real_nameï¼ˆå†—ä½™å­—æ®µï¼Œä¾¿äºæ˜¾ç¤ºï¼‰
    week_day: 1, // edu_course_offering.week_dayï¼ˆ1-7ï¼Œå‘¨ä¸€åˆ°å‘¨æ—¥ï¼‰
    start_period: 1, // edu_course_offering.start_periodï¼ˆèŠ‚æ¬¡ï¼‰
    end_period: 2, // edu_course_offering.end_period
    classroom_id: 301, // edu_classroom.classroom_id
    classroom_name: 'A301', // edu_classroom.classroom_nameï¼ˆå†—ä½™å­—æ®µï¼‰
  },
  {
    offering_id: 1002,
    course_id: 502,
    course_name: 'è½¯ä»¶å·¥ç¨‹',
    teacher_id: 202,
    teacher_name: 'åˆ˜è€å¸ˆ',
    week_day: 1,
    start_period: 4,
    end_period: 5,
    classroom_id: 302,
    classroom_name: 'B205',
  },
  {
    offering_id: 1003,
    course_id: 502,
    course_name: 'è½¯ä»¶å·¥ç¨‹',
    teacher_id: 202,
    teacher_name: 'åˆ˜è€å¸ˆ',
    week_day: 2,
    start_period: 1,
    end_period: 2,
    classroom_id: 303,
    classroom_name: 'A201',
  },
  {
    offering_id: 1004,
    course_id: 503,
    course_name: 'MVVMæ¡†æ¶',
    teacher_id: 203,
    teacher_name: 'ç†Šè€å¸ˆ',
    week_day: 2,
    start_period: 5,
    end_period: 5,
    classroom_id: 304,
    classroom_name: 'C102',
  },
  {
    offering_id: 1005,
    course_id: 504,
    course_name: 'Java Webé«˜çº§',
    teacher_id: 204,
    teacher_name: 'å„è€å¸ˆ',
    week_day: 3,
    start_period: 1,
    end_period: 2,
    classroom_id: 305,
    classroom_name: 'A301',
  },
  {
    offering_id: 1006,
    course_id: 505,
    course_name: 'æ•°å­¦å»ºæ¨¡',
    teacher_id: 205,
    teacher_name: 'ä¸è€å¸ˆ',
    week_day: 3,
    start_period: 3,
    end_period: 4,
    classroom_id: 306,
    classroom_name: 'B301',
  },
  {
    offering_id: 1007,
    course_id: 506,
    course_name: 'è½¯ä»¶è®¾è®¡',
    teacher_id: 202,
    teacher_name: 'åˆ˜è€å¸ˆ',
    week_day: 3,
    start_period: 5,
    end_period: 5,
    classroom_id: 307,
    classroom_name: 'C201',
  },
  {
    offering_id: 1008,
    course_id: 507,
    course_name: 'Javaåå°„',
    teacher_id: 206,
    teacher_name: 'ç½—è€å¸ˆ',
    week_day: 4,
    start_period: 1,
    end_period: 2,
    classroom_id: 308,
    classroom_name: 'A302',
  },
  {
    offering_id: 1009,
    course_id: 508,
    course_name: 'Dockerå®¹å™¨',
    teacher_id: 206,
    teacher_name: 'ç½—è€å¸ˆ',
    week_day: 4,
    start_period: 5,
    end_period: 5,
    classroom_id: 309,
    classroom_name: 'B401',
  },
  {
    offering_id: 1010,
    course_id: 501,
    course_name: 'è®¡ç®—æœºç½‘ç»œ',
    teacher_id: 201,
    teacher_name: 'å­”è€å¸ˆ',
    week_day: 5,
    start_period: 1,
    end_period: 2,
    classroom_id: 301,
    classroom_name: 'A301',
  },
  {
    offering_id: 1011,
    course_id: 506,
    course_name: 'è½¯ä»¶è®¾è®¡',
    teacher_id: 202,
    teacher_name: 'åˆ˜è€å¸ˆ',
    week_day: 6,
    start_period: 3,
    end_period: 4,
    classroom_id: 307,
    classroom_name: 'C201',
  },
  {
    offering_id: 1012,
    course_id: 503,
    course_name: 'MVVMæ¡†æ¶',
    teacher_id: 203,
    teacher_name: 'ç†Šè€å¸ˆ',
    week_day: 7,
    start_period: 3,
    end_period: 4,
    classroom_id: 304,
    classroom_name: 'C102',
  },
  {
    offering_id: 1013,
    course_id: 508,
    course_name: 'Dockerå®¹å™¨',
    teacher_id: 206,
    teacher_name: 'ç½—è€å¸ˆ',
    week_day: 7,
    start_period: 5,
    end_period: 5,
    classroom_id: 309,
    classroom_name: 'B401',
  },
]);
// ==================== ğŸ”´ æ¨¡æ‹Ÿæ•°æ® END ====================

// ==================== ğŸ”´ æ¨¡æ‹Ÿæ•°æ® START ====================
// TODO: åç»­éœ€è¦ä»åç«¯APIè·å–é€‰è¯¾åˆ—è¡¨
// APIæ¥å£: GET /api/student/courses
// å¯¹åº”æ•°æ®åº“è¡¨ï¼šedu_student_course, edu_course, edu_class, sys_user

// è¯¾ç¨‹åˆ—è¡¨æ•°æ®
const courseList = ref([
  {
    enrollment_id: 2001, // edu_student_course.enrollment_id
    course_id: 601, // edu_course.course_id
    course_code: 'MATH101', // edu_course.course_code
    course_name: 'é«˜ç­‰æ•°å­¦ï¼ˆä¸Šï¼‰', // edu_course.course_name
    class_id: 101, // edu_class.class_id
    class_name: 'æ•°å­¦ä¸€ç­', // edu_class.class_name
    grade: 2025, // edu_class.grade
    teacher_id: 211, // edu_teacher.teacher_id
    teacher_name: 'ç‹è€å¸ˆ', // sys_user.real_name
    credit: 4.0, // edu_course.creditï¼ˆå­¦åˆ†ï¼‰
    course_type: 'COMPULSORY', // edu_course.course_typeï¼ˆå¿…ä¿®ï¼‰
  },
  {
    enrollment_id: 2002,
    course_id: 602,
    course_code: 'PHYS101',
    course_name: 'å¤§å­¦ç‰©ç†',
    class_id: 102,
    class_name: 'ç‰©ç†äºŒç­',
    grade: 2025,
    teacher_id: 212,
    teacher_name: 'æè€å¸ˆ',
    credit: 3.5,
    course_type: 'COMPULSORY',
  },
  {
    enrollment_id: 2003,
    course_id: 603,
    course_code: 'CS101',
    course_name: 'è®¡ç®—æœºå¯¼è®º',
    class_id: 103,
    class_name: 'è®¡ç§‘ä¸€ç­',
    grade: 2025,
    teacher_id: 213,
    teacher_name: 'èµµè€å¸ˆ',
    credit: 3.0,
    course_type: 'COMPULSORY',
  },
  {
    enrollment_id: 2004,
    course_id: 604,
    course_code: 'MATH102',
    course_name: 'çº¿æ€§ä»£æ•°',
    class_id: 101,
    class_name: 'æ•°å­¦ä¸€ç­',
    grade: 2025,
    teacher_id: 214,
    teacher_name: 'å­™è€å¸ˆ',
    credit: 3.0,
    course_type: 'COMPULSORY',
  },
  {
    enrollment_id: 2005,
    course_id: 605,
    course_code: 'ENG101',
    course_name: 'è‹±è¯­ï¼ˆç»¼åˆï¼‰',
    class_id: 104,
    class_name: 'å¤–è¯­ä¸€ç­',
    grade: 2025,
    teacher_id: 215,
    teacher_name: 'é™ˆè€å¸ˆ',
    credit: 4.0,
    course_type: 'COMPULSORY',
  },
  {
    enrollment_id: 2006,
    course_id: 606,
    course_code: 'POL101',
    course_name: 'æ€æƒ³é“å¾·ä¸æ³•æ²»',
    class_id: 105,
    class_name: 'å…¬å…±è¯¾',
    grade: 2025,
    teacher_id: 216,
    teacher_name: 'å‘¨è€å¸ˆ',
    credit: 3.0,
    course_type: 'COMPULSORY',
  },
  {
    enrollment_id: 2007,
    course_id: 607,
    course_code: 'CS102',
    course_name: 'ç¨‹åºè®¾è®¡åŸºç¡€',
    class_id: 103,
    class_name: 'è®¡ç§‘ä¸€ç­',
    grade: 2025,
    teacher_id: 217,
    teacher_name: 'åˆ˜è€å¸ˆ',
    credit: 4.0,
    course_type: 'COMPULSORY',
  },
  {
    enrollment_id: 2008,
    course_id: 608,
    course_code: 'ENG102',
    course_name: 'å¤§å­¦è‹±è¯­',
    class_id: 104,
    class_name: 'å¤–è¯­ä¸€ç­',
    grade: 2025,
    teacher_id: 218,
    teacher_name: 'å¼ è€å¸ˆ',
    credit: 4.0,
    course_type: 'COMPULSORY',
  },
  {
    enrollment_id: 2009,
    course_id: 609,
    course_code: 'CS201',
    course_name: 'æ•°æ®ç»“æ„',
    class_id: 103,
    class_name: 'è®¡ç§‘ä¸€ç­',
    grade: 2025,
    teacher_id: 219,
    teacher_name: 'é’±è€å¸ˆ',
    credit: 4.0,
    course_type: 'COMPULSORY',
  },
  {
    enrollment_id: 2010,
    course_id: 610,
    course_code: 'CS202',
    course_name: 'æ“ä½œç³»ç»Ÿ',
    class_id: 103,
    class_name: 'è®¡ç§‘ä¸€ç­',
    grade: 2025,
    teacher_id: 220,
    teacher_name: 'å´è€å¸ˆ',
    credit: 3.5,
    course_type: 'COMPULSORY',
  },
  {
    enrollment_id: 2011,
    course_id: 611,
    course_code: 'MATH201',
    course_name: 'æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡',
    class_id: 101,
    class_name: 'æ•°å­¦ä¸€ç­',
    grade: 2025,
    teacher_id: 221,
    teacher_name: 'éƒ‘è€å¸ˆ',
    credit: 3.0,
    course_type: 'COMPULSORY',
  },
  {
    enrollment_id: 2012,
    course_id: 612,
    course_code: 'CS203',
    course_name: 'æ•°æ®åº“åŸç†',
    class_id: 103,
    class_name: 'è®¡ç§‘ä¸€ç­',
    grade: 2025,
    teacher_id: 222,
    teacher_name: 'é™ˆè€å¸ˆ',
    credit: 3.5,
    course_type: 'COMPULSORY',
  },
]);
// ==================== ğŸ”´ æ¨¡æ‹Ÿæ•°æ® END ====================

// è·å–è¯¾ç¨‹ï¼ˆæ ¹æ®æ˜ŸæœŸå’ŒèŠ‚æ¬¡ï¼‰
const getCourse = (day, period) => {
  return courses.value.find(
    c => c.week_day === day && c.start_period === period
  );
};

// è®¡ç®—è¯¾ç¨‹çŠ¶æ€ï¼ˆç”¨äºå‰ç«¯æ˜¾ç¤ºï¼Œä¸å­˜å‚¨åœ¨æ•°æ®åº“ï¼‰
const getCourseStatus = course => {
  // TODO: æ ¹æ® class_session è¡¨çš„æ•°æ®åˆ¤æ–­è¯¾ç¨‹çŠ¶æ€
  // è¿™é‡Œæš‚æ—¶è¿”å›æ¨¡æ‹ŸçŠ¶æ€ç”¨äºæ˜¾ç¤º
  const now = new Date();
  const currentDay = now.getDay() || 7; // å‘¨æ—¥ä¸º7
  const currentHour = now.getHours();

  if (course.week_day < currentDay) return 'done';
  if (course.week_day > currentDay) return 'not-started';

  // å½“å¤©çš„è¯¾ç¨‹æ ¹æ®æ—¶é—´åˆ¤æ–­
  const periodStartHours = [8, 10, 14, 16, 19];
  const startHour = periodStartHours[course.start_period - 1] || 8;

  if (currentHour < startHour) return 'upcoming';
  if (currentHour >= startHour + 2) return 'done';
  return 'upcoming';
};

// è·å–è¯¾ç¨‹å›¾æ ‡ï¼ˆç”¨äºå‰ç«¯æ˜¾ç¤ºï¼‰
const getCourseIcon = status => {
  const icons = {
    done: 'âœ“',
    upcoming: 'ğŸ”´',
    'not-started': 'â¸',
  };
  return icons[status] || 'â¸';
};

// ç‚¹å‡»è¯¾ç¨‹ï¼ˆè¯¾è¡¨è§†å›¾ï¼‰
const handleCourseClick = course => {
  ElMessage.info(`è¯¾ç¨‹è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­ï¼š${course.course_name}`);
};

// ç‚¹å‡»è¯¾ç¨‹å¡ç‰‡ï¼ˆè¯¾ç¨‹åˆ—è¡¨è§†å›¾ï¼‰
const handleCourseCardClick = course => {
  ElMessage.info(`è¯¾ç¨‹è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­ï¼š${course.course_name}`);
};
</script>

<template>
  <div class="course-schedule">
    <!-- å¤´éƒ¨æ§åˆ¶æ  -->
    <div class="schedule-header">
      <!-- å·¦ä¾§ï¼šå­¦æœŸé€‰æ‹© -->
      <div class="controls">
        <el-select v-model="selectedSemester" style="width: 200px">
          <el-option
            v-for="semester in semesters"
            :key="semester"
            :label="semester"
            :value="semester"
          />
        </el-select>
      </div>

      <!-- ä¸­é—´ï¼šå‘¨æ•°é€‰æ‹©å™¨ -->
      <div class="controls">
        <div class="week-picker">
          <div class="week-row">
            <el-button
              circle
              :icon="'ArrowLeft'"
              size="small"
              :disabled="currentWeek <= 1"
              @click="prevWeek"
            />
            <div class="week-list">
              <div
                v-for="week in visibleWeeks"
                :key="week"
                :class="['week-num', { active: week === currentWeek }]"
                @click="selectWeek(week)"
              >
                {{ week }}
              </div>
            </div>
            <el-button
              circle
              :icon="'ArrowRight'"
              size="small"
              :disabled="currentWeek >= totalWeeks"
              @click="nextWeek"
            />
            <!-- å…¨éƒ¨å‘¨æ•°æŒ‰é’® -->
            <el-popover placement="bottom" :width="300" trigger="click">
              <template #reference>
                <el-button class="all-weeks-btn" size="small">
                  å…¨éƒ¨å‘¨æ•°
                </el-button>
              </template>
              <div class="all-weeks-grid">
                <div
                  v-for="week in allWeeks"
                  :key="week"
                  :class="['week-item', { active: week === currentWeek }]"
                  @click="handleWeekSelect(week)"
                >
                  <span>{{ week }}</span>
                  <span class="week-item-label">å‘¨</span>
                </div>
              </div>
            </el-popover>
          </div>
          <div class="week-info">
            å½“å‰é€‰æ‹©ï¼š<span class="week-current">ç¬¬{{ currentWeek }}å‘¨</span>
          </div>
        </div>
      </div>

      <!-- å³ä¾§ï¼šè§†å›¾åˆ‡æ¢ -->
      <div class="controls controls-right">
        <el-button-group class="view-tabs">
          <el-button
            :type="currentViewType === 'schedule' ? 'primary' : 'default'"
            @click="currentViewType = 'schedule'"
          >
            è¯¾è¡¨
          </el-button>
          <el-button
            :type="currentViewType === 'courses' ? 'primary' : 'default'"
            @click="currentViewType = 'courses'"
          >
            è¯¾ç¨‹
          </el-button>
        </el-button-group>
      </div>
    </div>

    <!-- è¯¾è¡¨è§†å›¾ -->
    <div v-if="currentViewType === 'schedule'" class="schedule-wrap">
      <div class="schedule-legend">
        <div class="legend-item">
          <span style="color: #6b7280">â¸</span>
          <span>æœªå¼€æ’­</span>
        </div>
        <div class="legend-item">
          <span style="color: #16a34a">âœ“</span>
          <span>å·²å®Œæˆ</span>
        </div>
        <div class="legend-item">
          <span style="color: #dc2626">ğŸ”´</span>
          <span>å³å°†å¼€å§‹</span>
        </div>
      </div>

      <div class="schedule-grid">
        <!-- è¡¨å¤´ -->
        <div class="grid-header">
          <div style="background: linear-gradient(135deg, #f1f5f9, #e2e8f0)">
            æ—¶é—´
          </div>
          <div>å‘¨ä¸€<br /><span style="font-size: 11px">02-02</span></div>
          <div>å‘¨äºŒ<br /><span style="font-size: 11px">02-03</span></div>
          <div>å‘¨ä¸‰<br /><span style="font-size: 11px">02-04</span></div>
          <div>å‘¨å››<br /><span style="font-size: 11px">02-05</span></div>
          <div>å‘¨äº”<br /><span style="font-size: 11px">02-06</span></div>
          <div>å‘¨å…­<br /><span style="font-size: 11px">02-07</span></div>
          <div>å‘¨æ—¥<br /><span style="font-size: 11px">02-08</span></div>
        </div>

        <!-- æ—¶é—´åˆ— -->
        <div class="time-col">
          <div class="time-slot">1<br />08:00-10:00</div>
          <div class="time-slot">2<br />10:00-12:00</div>
          <div class="time-slot">3<br />14:30-16:30</div>
          <div class="time-slot">4<br />16:30-18:30</div>
          <div class="time-slot">5<br />19:30-21:30</div>
        </div>

        <!-- è¯¾ç¨‹æ ¼å­ -->
        <template v-for="day in 7" :key="`day-${day}`">
          <template v-for="period in 5" :key="`period-${period}`">
            <div
              v-if="getCourse(day, period)"
              :class="[
                'schedule-cell',
                `course-${getCourseStatus(getCourse(day, period))}`,
              ]"
              :style="{
                gridColumn: day + 1,
                gridRow: period + 1,
              }"
              @click="handleCourseClick(getCourse(day, period))"
            >
              <div class="course-content">
                <div class="course-name">
                  {{ getCourse(day, period).course_name }}
                </div>
                <div class="teacher-name">
                  {{ getCourse(day, period).teacher_name }}
                </div>
                <span class="status-icon">{{
                  getCourseIcon(getCourseStatus(getCourse(day, period)))
                }}</span>
              </div>
            </div>
            <div
              v-else
              :class="['schedule-cell', 'empty']"
              :style="{
                gridColumn: day + 1,
                gridRow: period + 1,
              }"
            ></div>
          </template>
        </template>
      </div>
    </div>

    <!-- è¯¾ç¨‹åˆ—è¡¨è§†å›¾ -->
    <div v-else class="course-list">
      <div
        v-for="course in courseList"
        :key="course.enrollment_id"
        class="course-card"
        @click="handleCourseCardClick(course)"
      >
        <div class="course-placeholder"></div>
        <h4>{{ course.course_name }}</h4>
        <div class="course-meta">
          å¹´çº§/ç­çº§ï¼š{{ course.grade }}çº§ {{ course.class_name }}
        </div>
        <div class="course-meta">ä»»è¯¾è€å¸ˆï¼š{{ course.teacher_name }}</div>
        <div class="course-meta">å­¦åˆ†ï¼š{{ course.credit }}</div>
      </div>
    </div>
  </div>
</template>
