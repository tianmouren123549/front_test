<style scoped>
/* è¯¾ç¨‹/è¯¾è¡¨è§†å›¾å®¹å™¨ */
.course-schedule {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
}

/* è¯¾ç¨‹/è¯¾è¡¨è§†å›¾ */
.schedule-header {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  border-bottom: 1px solid #e5e7eb;
  flex-shrink: 0;
}

.controls {
  display: flex;
  align-items: center;
  gap: 10px;
}

.controls-right {
  justify-content: flex-end;
}

.view-tabs {
  display: inline-flex;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  overflow: hidden;
}

.view-tabs .el-button {
  border: 0;
  border-radius: 0;
}

.view-tabs .el-button + .el-button {
  margin-left: 0;
}

/* è¯¾è¡¨ç½‘æ ¼ */
.schedule-wrap {
  padding: 18px 22px;
}

.schedule-legend {
  display: flex;
  justify-content: flex-end;
  gap: 16px;
  margin-bottom: 10px;
  font-size: 12px;
  color: #6b7280;
  flex-shrink: 0;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 4px;
}

.schedule-grid {
  display: grid;
  grid-template-columns: 85px repeat(7, 1fr);
  grid-template-rows: auto repeat(5, minmax(120px, 1fr));
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  overflow: hidden;
  background: white;
  max-height: calc(100vh - 280px);
}

.grid-header {
  display: contents;
}

.grid-header div {
  padding: 16px 10px;
  font-weight: 600;
  text-align: center;
  color: #475569;
  font-size: 13px;
  background: linear-gradient(135deg, #f8fafc, #e2e8f0);
  border-bottom: 2px solid #e2e8f0;
  border-right: 1px solid #e5e7eb;
}

.time-col {
  grid-column: 1;
  grid-row: 2 / -1;
  display: flex;
  flex-direction: column;
  background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
  border-right: 1px solid #e5e7eb;
}

.time-slot {
  padding: 14px 10px;
  font-size: 12px;
  color: #6b7280;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  line-height: 1.4;
  flex: 1;
  border-bottom: 1px solid #e5e7eb;
  font-weight: 600;
}

.time-slot:last-child {
  border-bottom: none;
}

.schedule-cell {
  border-right: 1px solid #e5e7eb;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 12px 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.schedule-cell:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  z-index: 1;
}

.schedule-cell.empty {
  background: #fafafa;
  cursor: default;
}

.schedule-cell.empty:hover {
  transform: none;
  box-shadow: none;
}

/* è¯¾ç¨‹çŠ¶æ€ */
.course-done {
  background: linear-gradient(135deg, #ecfdf5, #dcfce7);
  border: 1px solid #a7f3d0;
}

.course-upcoming {
  background: linear-gradient(135deg, #fef7f7, #fee2e2);
  border: 1px solid #fca5a5;
}

.course-not-started {
  background: linear-gradient(135deg, #f9fafb, #f3f4f6);
  border: 1px solid #d1d5db;
}

.course-content {
  width: 100%;
  text-align: center;
}

.course-name {
  font-size: 14px;
  font-weight: 600;
  line-height: 1.3;
  margin-bottom: 4px;
  color: #374151;
}

.teacher-name {
  font-size: 12px;
  color: #6b7280;
  line-height: 1.2;
}

.status-icon {
  position: absolute;
  top: 6px;
  right: 6px;
  font-size: 10px;
}

/* è¯¾ç¨‹åˆ—è¡¨ */
.course-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
  padding: 20px;
}

.course-card {
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 18px;
  background: #fff;
  transition: all 0.2s;
  cursor: pointer;
}

.course-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
}

.course-placeholder {
  height: 120px;
  border: 1px dashed #e5e7eb;
  border-radius: 10px;
  background: #fafafa;
  margin-bottom: 12px;
}

.course-card h4 {
  margin: 0 0 8px 0;
  font-size: 16px;
  color: #1f2544;
}

.course-meta {
  color: #6b7280;
  font-size: 13px;
  margin-bottom: 4px;
}

/* å‘¨æ•°é€‰æ‹©å™¨ */
.week-picker {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.week-row {
  display: flex;
  align-items: center;
  gap: 12px;
}

.week-list {
  display: flex;
  align-items: center;
  gap: 12px;
}

.week-num {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  color: #334155;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
}

.week-num:hover {
  background: #f1f5f9;
}

.week-num.active {
  background: var(--primary-color);
  color: #fff;
  box-shadow: 0 4px 12px rgba(91, 124, 255, 0.35);
}

.week-info {
  color: #6b7280;
  font-size: 12px;
  text-align: center;
}

.week-current {
  color: var(--primary-color);
  font-weight: 600;
}

/* å…¨éƒ¨å‘¨æ•°å¼¹å‡ºå±‚æ ·å¼ */
.all-weeks-btn {
  margin-left: 8px;
  background: linear-gradient(135deg, #f8fafc, #e2e8f0) !important;
  border-color: #cbd5e1 !important;
  color: #475569 !important;
  font-weight: 500;
}

.all-weeks-btn:hover {
  background: linear-gradient(135deg, #e2e8f0, #cbd5e1) !important;
  border-color: #94a3b8 !important;
  color: #334155 !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.all-weeks-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 8px;
  padding: 12px;
  max-width: 280px;
}

.week-item {
  width: 44px;
  height: 44px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  color: #64748b;
  background: linear-gradient(135deg, #ffffff, #f8fafc);
  cursor: pointer;
  transition: all 0.25s ease;
}

.week-item:hover {
  border-color: #94a3b8;
  color: #334155;
  background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(100, 116, 139, 0.15);
}

.week-item.active {
  background: linear-gradient(135deg, var(--primary-color), #4f81f5);
  color: white;
  border-color: var(--primary-color);
  box-shadow: 0 4px 16px rgba(91, 124, 255, 0.35);
  font-weight: 600;
}

.week-item-label {
  font-size: 10px;
  color: #cbd5e1;
  margin-top: 2px;
  font-weight: 400;
}

.week-item:hover .week-item-label {
  color: #94a3b8;
}

.week-item.active .week-item-label {
  color: rgba(255, 255, 255, 0.85);
}

/* å“åº”å¼ */
@media (max-width: 1200px) {
  .course-list {
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  }
}

@media (max-width: 860px) {
  .schedule-header {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .controls {
    justify-content: center;
  }

  .schedule-grid {
    font-size: 11px;
  }

  .course-name {
    font-size: 11px;
  }

  .teacher-name {
    font-size: 9px;
  }
}
</style>

<script setup>
import { ref, computed } from 'vue';
import { ElMessage } from 'element-plus';

// å½“å‰è§†å›¾ï¼šschedule(è¯¾è¡¨) æˆ– courses(è¯¾ç¨‹åˆ—è¡¨)
const currentViewType = ref('schedule');

// å­¦æœŸåˆ—è¡¨
const semesters = ref([
  '2025-2026 ä¸Šå­¦æœŸ',
  '2025-2026 ä¸‹å­¦æœŸ',
  '2024-2025 ä¸Šå­¦æœŸ',
]);
const selectedSemester = ref('2025-2026 ä¸Šå­¦æœŸ');

// å½“å‰å‘¨æ•°
const currentWeek = ref(2);
const totalWeeks = 20;

// å‘¨æ•°åˆ—è¡¨ï¼ˆçª—å£æ˜¾ç¤º5ä¸ªï¼‰
const visibleWeeks = ref([]);

// å…¨éƒ¨å‘¨æ•°åˆ—è¡¨ï¼ˆç”¨äºå¼¹å‡ºå±‚æ˜¾ç¤ºï¼‰
const allWeeks = computed(() => {
  const weeks = [];
  for (let i = 1; i <= totalWeeks; i++) {
    weeks.push(i);
  }
  return weeks;
});

// æ›´æ–°å¯è§å‘¨æ•°
const updateVisibleWeeks = () => {
  const start = Math.max(1, Math.min(currentWeek.value - 2, totalWeeks - 4));
  visibleWeeks.value = [];
  for (let i = start; i <= Math.min(totalWeeks, start + 4); i++) {
    visibleWeeks.value.push(i);
  }
};

// åˆ‡æ¢å‘¨æ•°
const prevWeek = () => {
  if (currentWeek.value > 1) {
    currentWeek.value--;
    updateVisibleWeeks();
  }
};

const nextWeek = () => {
  if (currentWeek.value < totalWeeks) {
    currentWeek.value++;
    updateVisibleWeeks();
  }
};

const selectWeek = week => {
  currentWeek.value = week;
  updateVisibleWeeks();
};

// ä»å…¨éƒ¨å‘¨æ•°ä¸­é€‰æ‹©æŸå‘¨
const handleWeekSelect = week => {
  currentWeek.value = week;
  updateVisibleWeeks();
  ElMessage.success(`å·²åˆ‡æ¢åˆ°ç¬¬${week}å‘¨`);
};

// åˆå§‹åŒ–å‘¨æ•°
updateVisibleWeeks();

// è¯¾ç¨‹æ•°æ®ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰
const courses = ref([
  {
    day: 1,
    period: 1,
    name: 'è®¡ç®—æœºç½‘ç»œ',
    teacher: 'å­”è€å¸ˆ',
    status: 'not-started',
    icon: 'â¸',
  },
  {
    day: 1,
    period: 4,
    name: 'è½¯ä»¶å·¥ç¨‹',
    teacher: 'åˆ˜è€å¸ˆ',
    status: 'not-started',
    icon: 'â¸',
  },
  {
    day: 2,
    period: 1,
    name: 'è½¯ä»¶å·¥ç¨‹',
    teacher: 'åˆ˜è€å¸ˆ',
    status: 'upcoming',
    icon: 'ğŸ”´',
  },
  {
    day: 2,
    period: 5,
    name: 'MVVMæ¡†æ¶',
    teacher: 'ç†Šè€å¸ˆ',
    status: 'upcoming',
    icon: 'ğŸ”´',
  },
  {
    day: 3,
    period: 1,
    name: 'Java Webé«˜çº§',
    teacher: 'å„è€å¸ˆ',
    status: 'done',
    icon: 'âœ“',
  },
  {
    day: 3,
    period: 3,
    name: 'æ•°å­¦å»ºæ¨¡',
    teacher: 'ä¸è€å¸ˆ',
    status: 'not-started',
    icon: 'â¸',
  },
  {
    day: 3,
    period: 5,
    name: 'è½¯ä»¶è®¾è®¡',
    teacher: 'åˆ˜è€å¸ˆ',
    status: 'not-started',
    icon: 'â¸',
  },
  {
    day: 4,
    period: 1,
    name: 'Javaåå°„',
    teacher: 'ç½—è€å¸ˆ',
    status: 'done',
    icon: 'âœ“',
  },
  {
    day: 4,
    period: 5,
    name: 'Dockerå®¹å™¨',
    teacher: 'ç½—è€å¸ˆ',
    status: 'upcoming',
    icon: 'ğŸ”´',
  },
  {
    day: 5,
    period: 1,
    name: 'è®¡ç®—æœºç½‘ç»œ',
    teacher: 'å­”è€å¸ˆ',
    status: 'not-started',
    icon: 'â¸',
  },
  {
    day: 6,
    period: 3,
    name: 'è½¯ä»¶è®¾è®¡',
    teacher: 'åˆ˜è€å¸ˆ',
    status: 'not-started',
    icon: 'â¸',
  },
  {
    day: 7,
    period: 3,
    name: 'MVVMæ¡†æ¶',
    teacher: 'ç†Šè€å¸ˆ',
    status: 'not-started',
    icon: 'â¸',
  },
  {
    day: 7,
    period: 5,
    name: 'Dockerå®¹å™¨',
    teacher: 'ç½—è€å¸ˆ',
    status: 'upcoming',
    icon: 'ğŸ”´',
  },
]);

// è¯¾ç¨‹åˆ—è¡¨æ•°æ®
const courseList = ref([
  {
    name: 'é«˜ç­‰æ•°å­¦ï¼ˆä¸Šï¼‰',
    grade: '2025çº§',
    class: 'æ•°å­¦ä¸€ç­',
    teacher: 'ç‹è€å¸ˆ',
  },
  { name: 'å¤§å­¦ç‰©ç†', grade: '2025çº§', class: 'ç‰©ç†äºŒç­', teacher: 'æè€å¸ˆ' },
  { name: 'è®¡ç®—æœºå¯¼è®º', grade: '2025çº§', class: 'è®¡ç§‘ä¸€ç­', teacher: 'èµµè€å¸ˆ' },
  { name: 'çº¿æ€§ä»£æ•°', grade: '2025çº§', class: 'æ•°å­¦ä¸€ç­', teacher: 'å­™è€å¸ˆ' },
  {
    name: 'è‹±è¯­ï¼ˆç»¼åˆï¼‰',
    grade: '2025çº§',
    class: 'å¤–è¯­ä¸€ç­',
    teacher: 'é™ˆè€å¸ˆ',
  },
  {
    name: 'æ€æƒ³é“å¾·ä¸æ³•æ²»',
    grade: '2025çº§',
    class: 'å…¬å…±è¯¾',
    teacher: 'å‘¨è€å¸ˆ',
  },
  {
    name: 'ç¨‹åºè®¾è®¡åŸºç¡€',
    grade: '2025çº§',
    class: 'è®¡ç§‘ä¸€ç­',
    teacher: 'åˆ˜è€å¸ˆ',
  },
  { name: 'å¤§å­¦è‹±è¯­', grade: '2025çº§', class: 'å¤–è¯­ä¸€ç­', teacher: 'å¼ è€å¸ˆ' },
  { name: 'æ•°æ®ç»“æ„', grade: '2025çº§', class: 'è®¡ç§‘ä¸€ç­', teacher: 'é’±è€å¸ˆ' },
  { name: 'æ“ä½œç³»ç»Ÿ', grade: '2025çº§', class: 'è®¡ç§‘ä¸€ç­', teacher: 'å´è€å¸ˆ' },
  {
    name: 'æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡',
    grade: '2025çº§',
    class: 'æ•°å­¦ä¸€ç­',
    teacher: 'éƒ‘è€å¸ˆ',
  },
  { name: 'æ•°æ®åº“åŸç†', grade: '2025çº§', class: 'è®¡ç§‘ä¸€ç­', teacher: 'é™ˆè€å¸ˆ' },
]);

// è·å–è¯¾ç¨‹ï¼ˆæ ¹æ®æ˜ŸæœŸå’ŒèŠ‚æ¬¡ï¼‰
const getCourse = (day, period) => {
  return courses.value.find(c => c.day === day && c.period === period);
};

// ç‚¹å‡»è¯¾ç¨‹
const handleCourseClick = course => {
  ElMessage.info(`è¯¾ç¨‹è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­ï¼š${course.name}`);
};

// ç‚¹å‡»è¯¾ç¨‹å¡ç‰‡
const handleCourseCardClick = course => {
  ElMessage.info(`è¯¾ç¨‹è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­ï¼š${course.name}`);
};
</script>

<template>
  <div class="course-schedule">
    <!-- å¤´éƒ¨æ§åˆ¶æ  -->
    <div class="schedule-header">
      <!-- å·¦ä¾§ï¼šå­¦æœŸé€‰æ‹© -->
      <div class="controls">
        <el-select v-model="selectedSemester" style="width: 200px">
          <el-option
            v-for="semester in semesters"
            :key="semester"
            :label="semester"
            :value="semester"
          />
        </el-select>
      </div>

      <!-- ä¸­é—´ï¼šå‘¨æ•°é€‰æ‹©å™¨ -->
      <div class="controls">
        <div class="week-picker">
          <div class="week-row">
            <el-button
              circle
              :icon="'ArrowLeft'"
              size="small"
              :disabled="currentWeek <= 1"
              @click="prevWeek"
            />
            <div class="week-list">
              <div
                v-for="week in visibleWeeks"
                :key="week"
                :class="['week-num', { active: week === currentWeek }]"
                @click="selectWeek(week)"
              >
                {{ week }}
              </div>
            </div>
            <el-button
              circle
              :icon="'ArrowRight'"
              size="small"
              :disabled="currentWeek >= totalWeeks"
              @click="nextWeek"
            />
            <!-- å…¨éƒ¨å‘¨æ•°æŒ‰é’® -->
            <el-popover placement="bottom" :width="300" trigger="click">
              <template #reference>
                <el-button class="all-weeks-btn" size="small">
                  å…¨éƒ¨å‘¨æ•°
                </el-button>
              </template>
              <div class="all-weeks-grid">
                <div
                  v-for="week in allWeeks"
                  :key="week"
                  :class="['week-item', { active: week === currentWeek }]"
                  @click="handleWeekSelect(week)"
                >
                  <span>{{ week }}</span>
                  <span class="week-item-label">å‘¨</span>
                </div>
              </div>
            </el-popover>
          </div>
          <div class="week-info">
            å½“å‰é€‰æ‹©ï¼š<span class="week-current">ç¬¬{{ currentWeek }}å‘¨</span>
          </div>
        </div>
      </div>

      <!-- å³ä¾§ï¼šè§†å›¾åˆ‡æ¢ -->
      <div class="controls controls-right">
        <el-button-group class="view-tabs">
          <el-button
            :type="currentViewType === 'schedule' ? 'primary' : 'default'"
            @click="currentViewType = 'schedule'"
          >
            è¯¾è¡¨
          </el-button>
          <el-button
            :type="currentViewType === 'courses' ? 'primary' : 'default'"
            @click="currentViewType = 'courses'"
          >
            è¯¾ç¨‹
          </el-button>
        </el-button-group>
      </div>
    </div>

    <!-- è¯¾è¡¨è§†å›¾ -->
    <div v-if="currentViewType === 'schedule'" class="schedule-wrap">
      <div class="schedule-legend">
        <div class="legend-item">
          <span style="color: #6b7280">â¸</span>
          <span>æœªå¼€æ’­</span>
        </div>
        <div class="legend-item">
          <span style="color: #16a34a">âœ“</span>
          <span>å·²å®Œæˆ</span>
        </div>
        <div class="legend-item">
          <span style="color: #dc2626">ğŸ”´</span>
          <span>å³å°†å¼€å§‹</span>
        </div>
      </div>

      <div class="schedule-grid">
        <!-- è¡¨å¤´ -->
        <div class="grid-header">
          <div style="background: linear-gradient(135deg, #f1f5f9, #e2e8f0)">
            æ—¶é—´
          </div>
          <div>å‘¨ä¸€<br /><span style="font-size: 11px">02-02</span></div>
          <div>å‘¨äºŒ<br /><span style="font-size: 11px">02-03</span></div>
          <div>å‘¨ä¸‰<br /><span style="font-size: 11px">02-04</span></div>
          <div>å‘¨å››<br /><span style="font-size: 11px">02-05</span></div>
          <div>å‘¨äº”<br /><span style="font-size: 11px">02-06</span></div>
          <div>å‘¨å…­<br /><span style="font-size: 11px">02-07</span></div>
          <div>å‘¨æ—¥<br /><span style="font-size: 11px">02-08</span></div>
        </div>

        <!-- æ—¶é—´åˆ— -->
        <div class="time-col">
          <div class="time-slot">1<br />08:00-10:00</div>
          <div class="time-slot">2<br />10:00-12:00</div>
          <div class="time-slot">3<br />14:30-16:30</div>
          <div class="time-slot">4<br />16:30-18:30</div>
          <div class="time-slot">5<br />19:30-21:30</div>
        </div>

        <!-- è¯¾ç¨‹æ ¼å­ -->
        <template v-for="day in 7" :key="`day-${day}`">
          <template v-for="period in 5" :key="`period-${period}`">
            <div
              v-if="getCourse(day, period)"
              :class="[
                'schedule-cell',
                `course-${getCourse(day, period).status}`,
              ]"
              :style="{
                gridColumn: day + 1,
                gridRow: period + 1,
              }"
              @click="handleCourseClick(getCourse(day, period))"
            >
              <div class="course-content">
                <div class="course-name">{{ getCourse(day, period).name }}</div>
                <div class="teacher-name">
                  {{ getCourse(day, period).teacher }}
                </div>
                <span class="status-icon">{{
                  getCourse(day, period).icon
                }}</span>
              </div>
            </div>
            <div
              v-else
              :class="['schedule-cell', 'empty']"
              :style="{
                gridColumn: day + 1,
                gridRow: period + 1,
              }"
            ></div>
          </template>
        </template>
      </div>
    </div>

    <!-- è¯¾ç¨‹åˆ—è¡¨è§†å›¾ -->
    <div v-else class="course-list">
      <div
        v-for="(course, index) in courseList"
        :key="index"
        class="course-card"
        @click="handleCourseCardClick(course)"
      >
        <div class="course-placeholder"></div>
        <h4>{{ course.name }}</h4>
        <div class="course-meta">
          å¹´çº§/ç­çº§ï¼š{{ course.grade }} {{ course.class }}
        </div>
        <div class="course-meta">ä»»è¯¾è€å¸ˆï¼š{{ course.teacher }}</div>
      </div>
    </div>
  </div>
</template>
